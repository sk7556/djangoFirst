# 목표

1. 템플릿 폴더 별도로 만들어 서빙
2. 템플릿 상속을 이용하여 base.html 파일 상속
3. bootstrap처럼 외부에 있는 UI를 샀을 경우


# 명령어

mkdir mysite 
cd mysite
python -m venv venv

# 가상환경 속으로 들어가기 

.\venv\Scripts\activate

# 장고 설치, 프로젝트 스타트
pip install django
django-admin startproject tutorialdjango .

# DB 환경 마이그레이트
python manage.py migrate

# 접근가능권한 설정
setting.py => ALLOWED_HOSTS = ['*']

# 기능 추가 
python manage.py startapp main
python manage.py startapp blog

setting.py => 'main', 'blog'


###################################
# urls 기획
1. 다음 url이 실제 작동하도록 해주세요.
1.1 ''
1.2 'blog/'
1.3 'blog/<int:pk>'
1.6 'blog/test' # 템플릿 태그와 템플릿 상속이 어떻게 이루어지는지 확인

###################################
앱이름: main      views 함수이름    html 파일이름    비고
        ' '      index             index.html

앱이름: blog    views 함수이름   html 파일이름  비고
'blog/'         blog            blog.html    
'blog/<int:pk>' post            post.html
'blog/<int:pk>' test            test.html

* test라는 이름 자체를 사용하지 않기를 권합니다.

###################################

# tutorialjango > urls.py
#### main , blog와 연결 
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('main.urls')),
    path('blog/', include('blog.urls')),
]

# main > urls.py 

# main > views.py


# templates 기본 폴더 변경 
### tutorialdjango > settings.py 

'DIRS': [ BASE_DIR / 'templates'],

--> 모든 templates는 맨 위의 templates에서 관리할 수 있게 됨 


# blog > urls.py
# blog > views.py
# 이 부분 내용들 자세히 볼 것 ...... DB 를 입력하고 받는 부분까지 


###################################
# 템플릿 태그, 템플릿 상속
## 템플릿 태그
{{ 변수명 }}
{% 템플릿 문법 %}

## 템플릿 상속
* 홈페이지를 조각내어 각각에 html로 관리하는 기법
* 부모 입장

... 위 코드 ...
{% block 이름 %}
{% endblock %}
... 아래 코드 ...

* 자식 입장

{% extends '부모html파일명' %}
{% block 이름 %}
... 실제 사용한 코드 ...
{% endblock %}

#############################################
# 실습
# menu.html
# templates > blog > menu_and_footer.html 파일 생성

#############################################
###################################
# blog > views.py
from django.shortcuts import render
from django.template.loader import render_to_string
from django.http import HttpResponse, JsonResponse
# from django.http import JsonResponse, HttpResponse, HttpResponseRedirect, HttpResponseNotFound, Http404, HttpResponseForbidden

def blog(request):
    return render(request, 'blog/blog.html')

def post(request, pk):
    return render(request, 'blog/post.html')

def test(request):
    # request => HttpRequest
    # return되는 응답값 => HttpResponse
    data = [
        {'title': 'Post 1', 'text': 'Text 1', 'pk': 1},
        {'title': 'Post 2', 'text': 'Text 2', 'pk': 2},
        {'title': 'Post 3', 'text': 'Text 3', 'pk': 3},
    ]
    # return HttpResponse('hello world') # 1
    # return HttpResponse('<h1>hello world</h1>') # 2

    s = '<h1>{{title}}</h1><p>{{text}}</p>'
    # return HttpResponse(s) # 3
    # return HttpResponse(s.replace('{{title}}', data[0]['title']).replace('{{text}}', data[0]['text'])) # 4 (그래서 내부에서 css나 js를 못읽는 것입니다.)

    header = '<h2>hell world</h2>'
    main = render_to_string('blog/test.txt', {'data': data[0]})
    footer = '<p>bye world</p>'

    '''
    blog/test.txt
    <p>hello blog</p>
    <p>{{data.title}}</p>
    <p>{{data.text}}</p>
    '''

    # return HttpResponse(header + main + footer) # 5

    # DRF, REST API
    # http://test.api.weniv.co.kr/mall 와 같이 만들 수 있습니다.
    # fetch로 쇼핑몰 만들어봤었죠?
    return JsonResponse(data, safe=False) # 6

###################################
# 마이크로식 운영 test
# index.html을 가상환경 바깥에 어딘가에 만듭니다. liveserver로 구동시키셔야 합니다.
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
</head>
<body>
    <script>
        // http://127.0.0.1:8000/blog 에서 fetch로 데이터를 json 형식으로 가져와서
        // 화면에 출력하는 코드입니다.
        // 다만 지금 cors 문제로 실행이 안됩니다.
        fetch('http://127.0.0.1:8000/blog/test/')
        .then(function(response) {
            return response.json();
        })
        .then(function(myJson) {
            console.log(myJson);
        });

        // https://blog.hometowndeveloper.com/63
    </script>
</body>
</html>
###################################
pip install django-cors-headers

# settings.py
INSTALLED_APPS = [
    'corsheaders', # 최상단에 놓으세요!
    ... 생략 ...
]

MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware', # 최상단에 놓으세요!
    ... 생략 ... 
]

CORS_ORIGIN_ALLOW_ALL = True # 모든 URL에 요청에 대해 허용!

CORS_ALLOW_CREDENTIALS = True

# CORS_ORIGIN_WHITELIST = [
#         'http://127.0.0.1:5500',
#         'http://127.0.0.1:8000',
#         'http://localhost:8000',
#         'http://localhost:5500',
# ]

###################################


